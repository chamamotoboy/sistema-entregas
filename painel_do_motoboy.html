<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Motoboy</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 700px; }
    .pedido { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
    button { margin-top: 10px; padding: 6px 12px; }
    select, input[type=number] { margin-top: 8px; padding: 4px; width: 100%; box-sizing: border-box; }
    .taxa { margin-top: 8px; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Painel do Motoboy</h1>

  <div id="listaPedidos"></div>

  <script>
    // Tabela de preços
    const precoMinimo = 10; // R$10 até 5 km
    const kmMinimo = 5;
    const precoPorKm = 2; // R$2 por km adicional

    // Carrega pedidos do localStorage
    function carregarPedidos() {
      return JSON.parse(localStorage.getItem('pedidos') || '[]');
    }

    // Salva pedidos no localStorage
    function salvarPedidos(pedidos) {
      localStorage.setItem('pedidos', JSON.stringify(pedidos));
    }

    // Calcula a taxa conforme km informado
    function calcularTaxa(km) {
      km = Number(km);
      if(isNaN(km) || km <= 0) return 0;
      if(km <= kmMinimo) return precoMinimo;
      return precoMinimo + (km - kmMinimo) * precoPorKm;
    }

    // Atualiza status do pedido e salva a taxa
    function atualizarStatus(index, novoStatus, taxa) {
      const pedidos = carregarPedidos();
      pedidos[index].status = novoStatus;
      pedidos[index].taxa = taxa; // salva taxa cobrada
      salvarPedidos(pedidos);
      mostrarPedidos();
    }

    // Mostra a lista de pedidos com controles para o motoboy
    function mostrarPedidos() {
      const pedidos = carregarPedidos();
      const lista = document.getElementById('listaPedidos');
      lista.innerHTML = '';

      if(pedidos.length === 0){
        lista.innerHTML = '<p>Nenhum pedido encontrado.</p>';
        return;
      }

      pedidos.forEach((p, i) => {
        const taxaAtual = p.taxa || 0;
        const kmAtual = p.km || '';

        const div = document.createElement('div');
        div.className = 'pedido';
        div.innerHTML = `
          <strong>Pedido #${i + 1}</strong><br/>
          Nome: ${p.nome} <br/>
          Telefone: ${p.telefone} <br/>
          Coleta: ${p.enderecoColeta} <br/>
          Entrega: ${p.enderecoEntrega} <br/>
          Status: <strong>${p.status}</strong><br/>

          <div>
            <label>Distância da entrega (km):<br/>
              <input type="number" min="0" step="0.1" value="${kmAtual}" id="km-${i}" />
            </label>
            <div class="taxa" id="taxa-${i}">Taxa estimada: R$ ${taxaAtual.toFixed(2)}</div>
          </div>

          <label>Atualizar status:
            <select id="status-${i}">
              <option value="pendente" ${p.status === 'pendente' ? 'selected' : ''}>Pendente</option>
              <option value="a caminho" ${p.status === 'a caminho' ? 'selected' : ''}>A caminho da coleta</option>
              <option value="entregue" ${p.status === 'entregue' ? 'selected' : ''}>Entregue</option>
            </select>
          </label>
          <button onclick="confirmarAtualizacao(${i})">Atualizar</button>
        `;
        lista.appendChild(div);

        // Atualiza a taxa quando muda o km
        document.getElementById(`km-${i}`).addEventListener('input', (e) => {
          const km = e.target.value;
          const taxa = calcularTaxa(km);
          document.getElementById(`taxa-${i}`).textContent = `Taxa estimada: R$ ${taxa.toFixed(2)}`;
        });
      });
    }

    // Confirma a atualização do pedido
    function confirmarAtualizacao(index) {
      const kmInput = document.getElementById(`km-${index}`);
      const statusSelect = document.getElementById(`status-${index}`);
      const km = Number(kmInput.value);
      if(isNaN(km) || km <= 0){
        alert('Por favor, insira uma distância válida em km.');
        return;
      }
      const taxa = calcularTaxa(km);
      if(confirm(`Confirmar atualização?\nDistância: ${km} km\nTaxa: R$ ${taxa.toFixed(2)}\nStatus: ${statusSelect.value}`)){
        const pedidos = carregarPedidos();
        pedidos[index].km = km;
        atualizarStatus(index, statusSelect.value, taxa);
      }
    }

    mostrarPedidos();
  </script>

</body>
</html>
